{% extends 'base.html' %}

{% block title %}Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Î£Ï…Î½Î±Î»Î»Î±Î³ÏÎ½ Credits{% endblock %}

{% block styles %}
<style>
    .action-icon { 
        text-decoration: none; 
        font-size: 1.2em; 
        margin-right: 5px; 
        cursor: pointer;
    }
    
    /* Responsive Î³Î¹Î± Mobile */
    @media (max-width: 768px) {
        .card {
            padding: 10px;
        }
        
        /* ÎšÏÏÏˆÎµ Ï„Î¿Î½ ÎºÎ±Î½Î¿Î½Î¹ÎºÏŒ Ï€Î¯Î½Î±ÎºÎ± */
        table {
            display: none;
        }
        
        /* Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ mobile-friendly cards */
        .mobile-transaction {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .mobile-transaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .mobile-transaction-date {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .mobile-transaction-amount {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .mobile-transaction-details {
            display: grid;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .mobile-transaction-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
        }
        
        .mobile-transaction-label {
            color: #666;
            font-weight: 500;
        }
        
        .mobile-transaction-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        
        /* Î¦ÏŒÏÎ¼Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ */
        form[action] {
            display: grid !important;
            grid-template-columns: 1fr !important;
            gap: 10px !important;
        }
        
        .form-group {
            width: 100%;
        }
        
        .btn-primary {
            width: 100%;
        }
    }

    /* Desktop: ÎšÏÏÏˆÎµ Ï„Î± mobile cards */
    @media (min-width: 769px) {
        .mobile-transactions {
            display: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<h1><span class="material-icons" style="font-size: 36px; vertical-align: middle;">history</span> Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Î£Ï…Î½Î±Î»Î»Î±Î³ÏÎ½</h1>

<div class="card" style="margin-bottom: 20px;">
    <h2>Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</h2>
    <form action="{{ url_for('credits.credits_history') }}" method="GET" style="display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: end;">
        <div class="form-group">
            <label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</label>
            <input type="date" name="date" value="{{ request.args.get('date', '') }}">
        </div>
        <button type="submit" class="btn-primary">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</button>
    </form>
</div>

<div class="card">
    <!-- Desktop Table -->
    <table>
        <thead>
            <tr>
                <th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î£Ï…Î½Î±Î»Î»Î±Î³Î®Ï‚</th>
                <th>Î Î¿ÏƒÏŒ</th>
                <th>Î‘Ï€ÏŒ</th>
                <th>Î‘ÏÏ‡Î¹ÎºÎ® Î—Î¼/Î½Î¯Î±</th>
                <th>Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚</th>
                <th style="text-align: center;">Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
            </tr>
        </thead>
        <tbody>
            {% for t in transactions %}
            <tr>
                <td>
                    {% if t['transaction_date'] %}
                        {{ t['transaction_date'].split('-')[2] }}-{{ t['transaction_date'].split('-')[1] }}-{{ t['transaction_date'].split('-')[0] }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td style="font-weight: bold;">
                    {% if t['transaction_type'] == 'purchase' %}
                        <span style="color: var(--danger-color);">â• {{ t['amount'] }} Credits</span>
                    {% else %}
                        <span style="color: var(--success-color);">âœ“ {{ t['amount'] }} Credits</span>
                    {% endif %}
                </td>
                <td>{{ t['debt_source'] or '-' }}</td>
                <td>
                    {% if t['original_date'] %}
                        {{ t['original_date'].split('-')[2] }}-{{ t['original_date'].split('-')[1] }}-{{ t['original_date'].split('-')[0] }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>{{ t['notes'] or '-' }}</td>
                <td style="text-align: center;">
                    <a href="/credits/transaction/{{ t['id'] }}/edit" class="action-icon" title="Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±">âœï¸</a>
                    <form action="{{ url_for('credits.delete_transaction', id=t['id']) }}" method="POST" style="display: inline;" onsubmit="return confirm('Î•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Ï‚ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ…Î½Î±Î»Î»Î±Î³Î®;')">
                        <button type="submit" style="background: none; border: none; cursor: pointer; font-size: 1.2em; padding: 0;" title="Î”Î¹Î±Î³ÏÎ±Ï†Î®">ğŸ—‘ï¸</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Mobile View -->
    <div class="mobile-transactions">
        {% for t in transactions %}
        <div class="mobile-transaction">
            <div class="mobile-transaction-header">
                <div class="mobile-transaction-date">
                    {% if t['transaction_date'] %}
                        {{ t['transaction_date'].split('-')[2] }}-{{ t['transaction_date'].split('-')[1] }}-{{ t['transaction_date'].split('-')[0] }}
                    {% else %}
                        -
                    {% endif %}
                </div>
                <div class="mobile-transaction-amount">
                    {% if t['transaction_type'] == 'purchase' %}
                        <span style="color: var(--danger-color);">â• {{ t['amount'] }}</span>
                    {% else %}
                        <span style="color: var(--success-color);">âœ“ {{ t['amount'] }}</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="mobile-transaction-details">
                <div class="mobile-transaction-row">
                    <span class="mobile-transaction-label">Î‘Ï€ÏŒ:</span>
                    <span>{{ t['debt_source'] or '-' }}</span>
                </div>
                <div class="mobile-transaction-row">
                    <span class="mobile-transaction-label">Î‘ÏÏ‡Î¹ÎºÎ® Î—Î¼/Î½Î¯Î±:</span>
                    <span>
                        {% if t['original_date'] %}
                            {{ t['original_date'].split('-')[2] }}-{{ t['original_date'].split('-')[1] }}-{{ t['original_date'].split('-')[0] }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                {% if t['notes'] %}
                <div class="mobile-transaction-row">
                    <span class="mobile-transaction-label">Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚:</span>
                    <span>{{ t['notes'] }}</span>
                </div>
                {% endif %}
            </div>
            
            <div class="mobile-transaction-actions">
                <a href="/credits/transaction/{{ t['id'] }}/edit" class="action-icon" title="Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±" style="font-size: 1.5em;">âœï¸</a>
                <form action="{{ url_for('credits.delete_transaction', id=t['id']) }}" method="POST" style="display: inline;" onsubmit="return confirm('Î•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Ï‚ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ…Î½Î±Î»Î»Î±Î³Î®;')">
                    <button type="submit" style="background: none; border: none; cursor: pointer; font-size: 1.5em; padding: 0;" title="Î”Î¹Î±Î³ÏÎ±Ï†Î®">ğŸ—‘ï¸</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if not transactions %}
    <p style="text-align: center; padding: 20px; color: #999;">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÏƒÏ…Î½Î±Î»Î»Î±Î³Î­Ï‚</p>
    {% endif %}
</div>

<!-- ÎšÎ¿Ï…Î¼Ï€Î¯ Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î®Ï‚ -->
<div style="margin-top: 20px;">
    <a href="{{ url_for('credits.credits_check') }}" class="btn-primary" style="display: inline-flex; align-items: center; gap: 5px; text-decoration: none; width: auto;">
        <span class="material-icons">arrow_back</span> Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î± Credits
    </a>
</div>

</script>
{% endblock %}
